<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ç”»åƒãƒœã‚¿ãƒ³ï¼ˆ8ã‚°ãƒªãƒƒãƒ‰ï¼‰</title>
<style>
  :root { --radius: 16px; }
  body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Hiragino Kaku Gothic ProN", "Noto Sans JP", sans-serif; margin: 0; background:#fff; }
  h1 { margin: 16px 0; }
  .panel {
    max-width: 720px; margin: 24px auto; padding: 24px;
    border: 2px solid #f0d96a; border-radius: 20px;
    background: #fffdf7;
  }
  .grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 24px;
  }
  /* ç”»åƒãƒœã‚¿ãƒ³ */
  .imgbtn {
    position: relative; border: none; padding: 0; cursor: pointer;
    border-radius: var(--radius); overflow: hidden; display: block;
    box-shadow: 0 6px 20px rgba(0,0,0,.12); background: #eee;
    aspect-ratio: 16 / 10;
  }
  .imgbtn:focus-visible { outline: 3px solid #1a73e8; outline-offset: 2px; }
  .imgbtn img { width: 100%; height: 100%; object-fit: cover; display: block; transition: transform .25s ease; }
  .imgbtn:hover img { transform: scale(1.04); }
  .imgbtn .label {
    position: absolute; inset: auto 12px 12px 12px; padding: 8px 14px; border-radius: 999px;
    background: rgba(0,0,0,.55); color: #fff; font-weight: 700; letter-spacing: .05em; font-size: 18px; text-shadow: 0 1px 2px rgba(0,0,0,.35);
    pointer-events: none; user-select: none;
  }

  /* === ãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‰çµæœUI === */
  .reco {
    max-width: 920px; margin: 12px auto 40px; padding: 16px 16px 4px;
  }
  .reco h2 { margin: 0 0 12px; font-size: 20px; }
  .reco .thinking {
    display:flex; align-items:center; gap:10px; padding:12px 14px; border:1px dashed #e3c94a; background:#fffaf0; border-radius:12px; margin-bottom:14px;
  }
  .dots { letter-spacing: 2px; }
  @keyframes blink { 0%,100%{opacity:.2} 50%{opacity:1} }
  .dots span { animation: blink 1.2s infinite; }
  .dots span:nth-child(2){ animation-delay:.2s }
  .dots span:nth-child(3){ animation-delay:.4s }

  .cards {
    display:grid; grid-template-columns: repeat(auto-fill, minmax(240px,1fr)); gap:16px;
  }
  .card {
    border:1px solid #eee; border-radius:14px; overflow:hidden; background:#fff; box-shadow:0 4px 14px rgba(0,0,0,.08);
  }
  .card img { width:100%; height:150px; object-fit:cover; display:block; }
  .card .body { padding:12px; }
  .badge { display:inline-block; font-size:12px; background:#ffeab6; color:#7a5000; padding:4px 8px; border-radius:999px; margin-right:6px; }
  .reason { color:#444; font-size:13px; line-height:1.5; margin-top:8px; }
  .actions { margin-top:10px; display:flex; gap:8px; }
  .btn {
    border:1px solid #ddd; background:#fff; border-radius:10px; padding:8px 10px; cursor:pointer;
  }
  .btn:hover { background:#fafafa; }

  /* å°ã•ã‚ç”»é¢ã§1åˆ— */
  @media (max-width: 520px) {
    .grid { grid-template-columns: 1fr; }
  }
</style>
</head>
<body>
  <h1 style="text-align:center">ç”°ä¸­ã•ã‚“ã‹ã‚‰ã‚®ãƒ•ãƒˆğŸãŒå±Šã„ã¦ã„ã¾ã™</h1>

  <div class="panel" aria-label="èˆˆå‘³ã‚«ãƒ†ã‚´ãƒªãƒ¼">
    <h1 style="text-align:center">ã©ã‚“ãªé£Ÿã¹ç‰©ãŒå¥½ãã§ã™ã‹ï¼Ÿï¼Ÿ</h1>
    <div class="grid" id="categoryGrid">
      <!-- å’Œé£Ÿ -->
      <button class="imgbtn" type="button" data-category="å’Œé£Ÿ" aria-label="å’Œé£Ÿ">
        <img src="https://masafushimi.github.io/gift/Q2_2/1111.png" alt="å’Œé£Ÿã®å†™çœŸ">
        <span class="label">å’Œé£Ÿ</span>
      </button>
      <!-- ãŠè‚‰ -->
      <button class="imgbtn" type="button" data-category="ãŠè‚‰" aria-label="ãŠè‚‰">
        <img src="https://masafushimi.github.io/gift/Q2_2/2222.png" alt="ãŠè‚‰ã®å†™çœŸ">
        <span class="label">ãŠè‚‰</span>
      </button>
      <!-- ãƒ•ãƒ«ãƒ¼ãƒ„ç³» -->
      <button class="imgbtn" type="button" data-category="ãƒ•ãƒ«ãƒ¼ãƒ„ç³»" aria-label="ãƒ•ãƒ«ãƒ¼ãƒ„ç³»">
        <img src="https://masafushimi.github.io/gift/Q2_2/3333.png" alt="ãƒ•ãƒ«ãƒ¼ãƒ„ç³»ã®å†™çœŸ">
        <span class="label">ãƒ•ãƒ«ãƒ¼ãƒ„ç³»</span>
      </button>
      <!-- é­šä»‹é¡ -->
      <button class="imgbtn" type="button" data-category="é­šä»‹é¡" aria-label="é­šä»‹é¡">
        <img src="https://masafushimi.github.io/gift/Q2_2/4444.png" alt="é­šä»‹é¡ã®å†™çœŸ">
        <span class="label">é­šä»‹é¡</span>
      </button>
    </div>
  </div>

  <!-- ãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‰çµæœã®æç”»é ˜åŸŸ -->
  <section class="reco" id="recoArea" hidden>
    <h2>AIã®ãŠã™ã™ã‚</h2>
    <div class="thinking" id="thinkingBox">
      <strong>è€ƒãˆä¸­</strong>
      <span class="dots"><span>â—</span><span>â—</span><span>â—</span></span>
      <small id="thinkingMsg">å¥½ã¿ã«åˆã†ã‚®ãƒ•ãƒˆå€™è£œã‚’æ¨è«–ã—ã¦ã„ã¾ã™â€¦</small>
    </div>
    <div class="cards" id="recoCards"></div>
  </section>

  <script>
    const grid = document.getElementById("categoryGrid");
    const recoArea = document.getElementById("recoArea");
    const recoCards = document.getElementById("recoCards");
    const thinkingBox = document.getElementById("thinkingBox");
    const thinkingMsg = document.getElementById("thinkingMsg");

      // â–¼ è¿½åŠ ï¼šã‚ªãƒ•ã‚»ãƒƒãƒˆä»˜ãã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é–¢æ•°ï¼ˆè¦‹å‡ºã—ã®å°‘ã—ä¸‹ã¾ã§è¡¨ç¤ºï¼‰
  function scrollToReco(offset = 100) {
    const y = recoArea.getBoundingClientRect().top + window.pageYOffset - offset;
    window.scrollTo({ top: y, behavior: "smooth" });
  }

    grid.addEventListener("click", async (e) => {
      const btn = e.target.closest(".imgbtn");
      if (!btn) return;
      const category = btn.dataset.category;

      // UI: ãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‰ã‚¨ãƒªã‚¢è¡¨ç¤º & ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°
      recoArea.hidden = false;
      recoCards.innerHTML = "";
      thinkingBox.style.display = "flex";
      thinkingMsg.textContent = `ã€Œ${category}ã€ã‹ã‚‰é€£æƒ³ã—ã¦ãŠã™ã™ã‚ã‚’çµ„ã¿ç«‹ã¦ã¦ã„ã¾ã™â€¦`;

      // ğŸ‘‡ ã“ã“ã‚’è¿½åŠ ï¼šAIãŠã™ã™ã‚ã‚¨ãƒªã‚¢ã¸è‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
     scrollToReco(120); 

      // ç–‘ä¼¼AIãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‰ï¼ˆâ˜…æœ¬ç•ªã§ã¯ã“ã“ã‚’fetchã«å·®ã—æ›¿ãˆï¼‰
      // ä¾‹: const data = await realAiRecommend(category);
      const data = await fakeAiRecommend(category);

      // è¡¨ç¤º
      thinkingBox.style.display = "none";
      renderCards(data);
    });

    // ç–‘ä¼¼AIï¼šã‚«ãƒ†ã‚´ãƒªã«å¿œã˜ã¦â€œãã‚Œã£ã½ã„â€å€™è£œï¼‹ç†ç”±ã‚’è¿”ã™
    async function fakeAiRecommend(category) {
      await wait(900 + Math.random()*800); // ã¡ã‚‡ã£ã¨è€ƒãˆã‚‹
      const DB = {
        "ãŠè‚‰": [
          {
            title: "é»’æ¯›å’Œç‰› ã™ãç„¼ãç”¨ 600g",
            img: "https://masafushimi.github.io/gift/Q2_2/a.jpg",
            tags: ["è´…æ²¢", "å®¶æ—ã§"],
            reason: "ç”˜ã‚ã®å‰²ä¸‹ã§æ¥½ã—ã‚ã‚‹è–„åˆ‡ã‚Šã€‚è„‚ã®ã‚­ãƒ¬ãŒã‚ˆãã€ä¸‡äººå—ã‘ã—ã¾ã™ã€‚"
          },
          {
            title: "ç±³æ²¢ç‰› ã‚µãƒ¼ãƒ­ã‚¤ãƒ³ã‚¹ãƒ†ãƒ¼ã‚­ 200gÃ—2",
            img: "https://masafushimi.github.io/gift/Q2_2/b1.jpg",
            tags: ["ã”ã¡ãã†", "ç„¼ãã ã‘"],
            reason: "åšåˆ‡ã‚Šã§æº€è¶³æ„Ÿã€‚å¡©èƒ¡æ¤’ã ã‘ã§æ—¨ã¿ãŒç«‹ã¡ã¾ã™ã€‚ã‚®ãƒ•ãƒˆæ˜ ãˆâ—"
          },
          {
            title: "ç†Ÿæˆãƒ­ãƒ¼ã‚¹ãƒˆãƒ“ãƒ¼ãƒ• 400g",
            img: "https://masafushimi.github.io/gift/Q2_2/c.jpg",
            tags: ["åˆ‡ã‚‹ã ã‘", "æ—¥æŒã¡"],
            reason: "è§£å‡â†’ã‚«ãƒƒãƒˆã§OKã€‚ãƒ¯ã‚¤ãƒ³ã‚„å’Œæƒ£èœã¨ã‚‚ç›¸æ€§ã‚ˆã—ã€‚"
          }
        ],
        "å’Œé£Ÿ": [
          { title:"éŠ€ã ã‚‰è¥¿äº¬æ¼¬ã‘ è©°ã‚åˆã‚ã›", img:"https://masafushimi.github.io/gift/Q2_2/d.jpg", tags:["ç™½ç±³ã«åˆã†"], reason:"ãƒ¬ãƒ³ãƒãƒ³ã§ã‚‚ãµã£ãã‚‰ã€‚å†·å‡åº«å¸¸å‚™ã«å–œã°ã‚Œã¾ã™ã€‚" },
          { title:"å‡ºæ±ã‚»ãƒƒãƒˆï¼ˆé°¹ãƒ»æ˜†å¸ƒãƒ»æ¤èŒ¸ï¼‰", img:"https://masafushimi.github.io/gift/Q2_2/e.jpg", tags:["å¥åº·å¿—å‘"], reason:"æ¯æ—¥ã®å‘³å™Œæ±ã‚„ç…®ç‰©ãŒãƒ¯ãƒ³ãƒ©ãƒ³ã‚¯UPã€‚" },
        ],
        "ãƒ•ãƒ«ãƒ¼ãƒ„ç³»": [
          { title:"å­£ç¯€ã®ãƒ•ãƒ«ãƒ¼ãƒ„BOX", img:"https://images.unsplash.com/photo-1576402187878-974f70c890a5?q=80&w=1200&auto=format&fit=crop", tags:["æ—¬", "ã‚«ãƒ©ãƒ•ãƒ«"], reason:"ç”˜å‘³ã¨é¦™ã‚Šã®ãƒ”ãƒ¼ã‚¯ã‚’ç”£åœ°ç›´é€ã€‚" }
        ],
        "é­šä»‹é¡": [
          { title:"ãšã‚ã„èŸ¹ã‚€ãèº«ã‚»ãƒƒãƒˆ", img:"https://images.unsplash.com/photo-1604908812463-3a7d9c9f2f5a?q=80&w=1200&auto=format&fit=crop", tags:["é‹", "è´…æ²¢"], reason:"æ®»ã‚€ãä¸è¦ã§é£Ÿã¹ã‚„ã™ã„ã€‚å¹´æœ«å¹´å§‹ã«æœ€é©ã€‚" }
        ]
      };
      // æœªå®šç¾©ã‚«ãƒ†ã‚´ãƒªã§ã‚‚ä½•ã‹è¿”ã™
      const items = DB[category] || [
        { title:`${category}ã«åˆã†å®šç•ªã‚®ãƒ•ãƒˆ`, img:"https://images.unsplash.com/photo-1504674900247-0877df9cc836?q=80&w=1200&auto=format&fit=crop", tags:["å®šç•ª"], reason:"ã¾ãšã¯é–“é•ã„ãªã„ãƒ™ãƒ¼ã‚·ãƒƒã‚¯ã‹ã‚‰ã€‚" }
      ];
      // ç°¡å˜ãªâ€œãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºé¢¨â€ã‚·ãƒ£ãƒƒãƒ•ãƒ«
      return items.sort(() => Math.random() - .5).slice(0, Math.min(3, items.length));
    }

    function renderCards(list){
      recoCards.innerHTML = list.map(item => cardHTML(item)).join("");
      // ã‚¯ãƒªãƒƒã‚¯è¨ˆæ¸¬ç­‰
      recoCards.querySelectorAll(".btn-select").forEach(btn=>{
        btn.addEventListener("click", () => alert(`ã€Œ${btn.dataset.title}ã€ã‚’å€™è£œã«è¿½åŠ ã—ã¾ã—ãŸï¼`));
      });
      document.querySelectorAll(".btn-retry").forEach(btn=>{
        btn.addEventListener("click", async ()=>{
          thinkingBox.style.display="flex";
          recoCards.innerHTML="";
          const data = await fakeAiRecommend(btn.dataset.category);
          thinkingBox.style.display="none";
          renderCards(data);
        });
      });
    }

    const cardHTML = (item) => `
      <article class="card">
        <img src="${item.img}" alt="">
        <div class="body">
          <div>${(item.tags||[]).map(t=>`<span class="badge">#${t}</span>`).join("")}</div>
          <h3 style="margin:8px 0 4px; font-size:16px;">${escapeHtml(item.title)}</h3>
          <p class="reason">${escapeHtml(item.reason||"")}</p>
          <div class="actions">
            <a href="https://masafushimi.github.io/gift/send/"><button class="btn btn-select" data-title="${escapeAttr(item.title)}">ã“ã‚Œã«ã™ã‚‹</button></a>
            <button class="btn btn-retry" data-category="ãŠè‚‰">å†ææ¡ˆ</button>
          </div>
        </div>
      </article>
    `;

    const wait = (ms)=> new Promise(r=>setTimeout(r, ms));
    const escapeHtml = (s)=> String(s).replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m]));
    const escapeAttr = escapeHtml;

    /* === æœ¬ç•ªAPIã«å·®ã—æ›¿ãˆã‚‹å ´åˆã®ä¾‹ ===
    async function realAiRecommend(category){
      const res = await fetch('/api/recommend', {
        method:'POST',
        headers:{ 'Content-Type':'application/json' },
        body: JSON.stringify({ category })
      });
      return await res.json(); // [{title, img, tags:[], reason}]
    }
    */
  </script>
</body>
</html>
