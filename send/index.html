<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ã‚®ãƒ•ãƒˆé€ä»˜å…ˆãƒ•ã‚©ãƒ¼ãƒ </title>
<style>
  :root{
    --accent:#29a86b; /* ç·‘ãƒœã‚¿ãƒ³ */
    --border:#e6e6e6;
    --hint:#9aa0a6;
    --label:#111;
    --chip-req:#ffb300;
    --chip-opt:#ffd87a;
    --radius:12px;
  }
  body{margin:0;font-family:system-ui,-apple-system,"Hiragino Kaku Gothic ProN","Noto Sans JP",sans-serif;color:#222;background:#fff;}
  .wrap{max-width:960px;margin:28px auto 64px;padding:0 20px;}
  header{margin:8px 0 28px;}
  .to-line{font-size:28px;font-weight:700;margin:0 0 20px;}
  .lead{font-size:28px;line-height:1.5;text-align:center;margin:0 0 6px;}
  .sub{font-size:20px;text-align:center;margin:0 24px 30px;}
  .card{border:1px solid var(--border);border-radius:16px;padding:16px 18px;background:#fff;box-shadow:0 8px 24px rgba(0,0,0,.04);}

  /* é¸æŠã‚¢ã‚¤ãƒ†ãƒ è¡¨ç¤º */
  .item{display:flex;gap:14px;align-items:center;margin:0 auto 20px;max-width:760px;}
  .thumb{width:90px;height:56px;border-radius:10px;background:#eee;object-fit:cover;flex:none}
  .item h3{margin:0;font-size:18px}
  .muted{color:#666;font-size:13px}

  /* ãƒ•ã‚©ãƒ¼ãƒ  */
  form{max-width:760px;margin:0 auto;}
  .field{margin:14px 0;}
  .row{display:flex;gap:14px}
  .row>.field{flex:1}
  label{display:flex;align-items:center;gap:8px;font-weight:700;color:var(--label);margin-bottom:8px}
  .chip{display:inline-block;font-size:12px;padding:3px 8px;border-radius:999px}
  .req{background:var(--chip-req)}
  .opt{background:var(--chip-opt)}
  .ctrl{
    position:relative;
  }
  input[type="text"],input[type="tel"],input[type="email"],input[type="datetime-local"],textarea{
    width:100%;box-sizing:border-box;font-size:16px;padding:12px 14px 12px 44px;border:1px solid var(--border);
    border-radius:12px;background:#fafafa;outline:none;transition:border .15s,box-shadow .15s;
  }
  textarea{min-height:120px;resize:vertical}
  input:focus,textarea:focus{border-color:#cfcfcf;box-shadow:0 0 0 3px #f2f6ff}
  .icon{position:absolute;left:12px;top:50%;transform:translateY(-50%);color:#9aa0a6;font-size:18px}
  .hint{font-size:12px;color:var(--hint);margin-top:6px}
  .error{color:#d93025;font-size:12px;margin-top:6px;display:none}
  .is-error .error{display:block}
  .is-error input,.is-error textarea{border-color:#ef9a9a;box-shadow:0 0 0 3px #fdeeee}

  /* ãƒã‚§ãƒƒã‚¯ç³» */
  .check{display:flex;align-items:center;gap:10px;margin:16px 0 6px}
  .actions{display:flex;gap:10px;justify-content:flex-start;margin-top:18px}
  .btn{
    border:1px solid #cfd8dc;background:#fff;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer
  }
  .btn.primary{background:var(--accent);color:#fff;border-color:transparent}
  .btn.primary:hover{filter:brightness(.98)}
  .btn:disabled{opacity:.6;cursor:not-allowed}

  /* ç¢ºèªç”»é¢ */
  .confirm{max-width:760px;margin:22px auto 0}
  .kv{display:grid;grid-template-columns:140px 1fr;gap:6px 14px;font-size:15px}
  .kv div{padding:8px 0;border-bottom:1px dashed #eee}
  .kv .k{color:#666}

  @media (max-width:560px){
    .row{flex-direction:column}
    .lead{font-size:22px}
    .sub{font-size:16px}
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <p class="to-line" id="toLine">ãŠå®¢æ§˜ã¸</p>
      <p class="lead" id="leadText"><span id="fromName">ã”å‹äºº</span>æ§˜ã‚ˆã‚Šã‚®ãƒ•ãƒˆãŒé€ã‚‰ã‚Œã¾ã™ã€‚</p>
      <p class="sub">ã”é€ä»˜å…ˆã‚’ã”è¨˜å…¥ãã ã•ã„</p>
    </header>

    <!-- é¸æŠã‚¢ã‚¤ãƒ†ãƒ ã®ç°¡æ˜“è¡¨ç¤º -->
    <div class="card item" id="itemCard" aria-live="polite">
      <img class="thumb" id="itemThumb" alt="">
      <div>
        <h3 id="itemTitle">é¸æŠã•ã‚ŒãŸã‚®ãƒ•ãƒˆ</h3>
        <div class="muted" id="itemNote">å†…å®¹ã‚’ã”ç¢ºèªã®ã†ãˆã€ä¸‹è¨˜ã«é€ä»˜å…ˆã‚’ã”å…¥åŠ›ãã ã•ã„ã€‚</div>
      </div>
    </div>

    <!-- å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  -->
    <form id="giftForm" novalidate>
      <div class="field">
        <label for="zip">éƒµä¾¿ç•ªå· <span class="chip opt">ä»»æ„</span></label>
        <div class="ctrl">
          <span class="icon">ã€’</span>
          <input type="text" id="zip" name="zip" inputmode="numeric" pattern="\\d{3}-?\\d{4}" placeholder="ä¾‹ï¼‰100-0001">
        </div>
        <div class="hint">ãƒã‚¤ãƒ•ãƒ³ã‚ã‚Šãƒ»ãªã— ã©ã¡ã‚‰ã§ã‚‚å¯ï¼ˆè‡ªå‹•å¤‰æ›ã—ã¾ã›ã‚“ï¼‰</div>
      </div>

      <div class="field is-required" id="f-address">
        <label for="address">ã”ä½æ‰€ <span class="chip req">å¿…é ˆ</span></label>
        <div class="ctrl">
          <span class="icon">ğŸ“®</span>
          <input type="text" id="address" name="address" required placeholder="ä¾‹ï¼‰æ±äº¬éƒ½ä¸­å¤®åŒºæ—¥æœ¬æ©‹1-1-1 æ—¥æœ¬æ©‹é«˜å³¶å±‹ä¸‰äº•ãƒ“ãƒ« 32F">
        </div>
        <div class="error">ã”ä½æ‰€ã‚’ã”å…¥åŠ›ãã ã•ã„</div>
      </div>

      <div class="row">
        <div class="field">
          <label for="company">ä¼šç¤¾å <span class="chip opt">ä»»æ„</span></label>
          <div class="ctrl">
            <span class="icon">ğŸ¢</span>
            <input type="text" id="company" name="company" placeholder="ä¾‹ï¼‰æ ªå¼ä¼šç¤¾ã€‡ã€‡">
          </div>
        </div>
        <div class="field">
          <label for="dept">éƒ¨ç½²å <span class="chip opt">ä»»æ„</span></label>
          <div class="ctrl">
            <span class="icon">ğŸ‘¥</span>
            <input type="text" id="dept" name="dept" placeholder="ä¾‹ï¼‰å–¶æ¥­éƒ¨ ç¬¬1ã‚°ãƒ«ãƒ¼ãƒ—">
          </div>
        </div>
      </div>

      <div class="row">
        <div class="field is-required" id="f-name">
          <label for="fullname">æ°å <span class="chip req">å¿…é ˆ</span></label>
          <div class="ctrl">
            <span class="icon">ğŸ‘¤</span>
            <input type="text" id="fullname" name="fullname" required placeholder="ä¾‹ï¼‰å±±ç”° å¤ªéƒ">
          </div>
          <div class="error">ãŠåå‰ã‚’ã”å…¥åŠ›ãã ã•ã„</div>
        </div>
        <div class="field">
          <label for="kana">ãƒ•ãƒªã‚¬ãƒŠ <span class="chip opt">ä»»æ„</span></label>
          <div class="ctrl">
            <span class="icon">ï½±</span>
            <input type="text" id="kana" name="kana" placeholder="ä¾‹ï¼‰ãƒ¤ãƒãƒ€ ã‚¿ãƒ­ã‚¦">
          </div>
        </div>
      </div>

      <div class="row">
        <div class="field is-required" id="f-tel">
          <label for="tel">é›»è©±ç•ªå· <span class="chip req">å¿…é ˆ</span></label>
          <div class="ctrl">
            <span class="icon">ğŸ“</span>
            <input type="tel" id="tel" name="tel" required inputmode="tel" pattern="^[0-9+\\-\\s]{9,15}$" placeholder="ä¾‹ï¼‰080-1234-5678">
          </div>
          <div class="error">é›»è©±ç•ªå·ã‚’æ­£ã—ãå…¥åŠ›ã—ã¦ãã ã•ã„</div>
        </div>
        <div class="field">
          <label for="email">ãƒ¡ãƒ¼ãƒ« <span class="chip opt">ä»»æ„</span></label>
          <div class="ctrl">
            <span class="icon">âœ‰ï¸</span>
            <input type="email" id="email" name="email" placeholder="ä¾‹ï¼‰taro@example.com">
          </div>
        </div>
      </div>

      <div class="row">
        <div class="field">
          <label for="datetime">é…é”å¸Œæœ›æ—¥æ™‚ <span class="chip opt">ä»»æ„</span></label>
          <div class="ctrl">
            <span class="icon">ğŸ—“ï¸</span>
            <input type="datetime-local" id="datetime" name="datetime">
          </div>
          <div class="hint">ä¸€éƒ¨ã‚¨ãƒªã‚¢ãƒ»å•†å“ã§ã¯ã”å¸Œæœ›ã«æ²¿ãˆãªã„å ´åˆãŒã‚ã‚Šã¾ã™</div>
        </div>
      </div>

      <div class="check">
        <input type="checkbox" id="thanks">
        <label for="thanks" style="font-weight:600">ãŠç¤¼ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å±Šã‘ã‚‹</label>
      </div>
      <div class="field" id="thanksBox" style="display:none">
        <div class="ctrl">
          <span class="icon">ğŸ“</span>
          <textarea id="thanksMsg" name="thanksMsg" placeholder="ã“ã®åº¦ã¯ã€ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆã‚’ãŠè´ˆã‚Šã„ãŸã ãã¾ã—ã¦ã€èª ã«ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚"></textarea>
        </div>
        <div class="hint">è´ˆã‚Šä¸»ï¼ˆé€ä¿¡è€…ï¼‰ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå±Šãã¾ã™</div>
      </div>

      <div class="actions">
        <button class="btn" type="button" id="btnBack" onclick="history.back()">æˆ»ã‚‹</button>
        <button class="btn primary" type="submit" id="btnConfirm">ç¢ºèªã™ã‚‹</button>
      </div>
    </form>

    <!-- ç¢ºèªç”»é¢ -->
    <div class="card confirm" id="confirmView" hidden>
      <h3 style="margin:4px 0 10px">å…¥åŠ›å†…å®¹ã®ç¢ºèª</h3>
      <div class="kv" id="kv"></div>
      <div class="actions">
        <button class="btn" id="btnEdit">ä¿®æ­£ã™ã‚‹</button>
        <button class="btn primary" id="btnSend">é€ä¿¡ã™ã‚‹</button>
      </div>
      <p class="hint" style="margin-top:10px">â€» é€ä¿¡ã™ã‚‹ã¨å†…å®¹ãŒç¢ºå®šã—ã¾ã™</p>
    </div>
  </div>

<script>
  // ===== ãƒ˜ãƒƒãƒ€ãƒ¼æ–‡è¨€ã‚’ã‚¯ã‚¨ãƒªã‹ã‚‰åæ˜  =====
  const q = new URLSearchParams(location.search);
  const toName   = q.get("to")   || "ãŠå®¢æ§˜";
  const fromName = q.get("from") || "ã”å‹äºº";
  const itemName = q.get("item") || "é¸æŠã•ã‚ŒãŸã‚®ãƒ•ãƒˆ";
  const itemImg  = q.get("img")  || ""; // ç”»åƒURLãŒã‚ã‚Œã°æ¸¡ã™

  document.getElementById("toLine").textContent = `${toName}æ§˜ã¸`;
  document.getElementById("fromName").textContent = fromName;
  document.getElementById("itemTitle").textContent = itemName;
  const thumb = document.getElementById("itemThumb");
  if(itemImg){ thumb.src = itemImg; thumb.alt = itemName; } else { thumb.style.background="#f0f0f0"; }

  // ===== â€œãŠç¤¼â€ãƒã‚§ãƒƒã‚¯ã§ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢è¡¨ç¤º =====
  const thanks = document.getElementById("thanks");
  const thanksBox = document.getElementById("thanksBox");
  thanks.addEventListener("change", ()=> thanksBox.style.display = thanks.checked ? "block" : "none");

  // ===== ç¢ºèªç”»é¢ã«åˆ‡æ›¿ =====
  const form = document.getElementById("giftForm");
  const confirmView = document.getElementById("confirmView");
  const kv = document.getElementById("kv");

  form.addEventListener("submit", (e)=>{
    e.preventDefault();
    // ç°¡æ˜“ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    let ok = true;
    ok &= toggleError("f-address", !form.address.value.trim());
    ok &= toggleError("f-name",    !form.fullname.value.trim());
    ok &= toggleError("f-tel",     !/^[0-9+\-\s]{9,15}$/.test(form.tel.value.trim()));
    if(!ok) return;

    // è¡¨ç¤ºç”¨ã«ã¾ã¨ã‚ã‚‹
    const data = {
      "å®›å": `${toName} æ§˜`,
      "è´ˆã‚Šä¸»": `${fromName} æ§˜`,
      "å•†å“": itemName,
      "éƒµä¾¿ç•ªå·": form.zip.value,
      "ä½æ‰€": form.address.value,
      "ä¼šç¤¾å": form.company.value,
      "éƒ¨ç½²": form.dept.value,
      "æ°å": form.fullname.value,
      "ãƒ•ãƒªã‚¬ãƒŠ": form.kana.value,
      "é›»è©±ç•ªå·": form.tel.value,
      "ãƒ¡ãƒ¼ãƒ«": form.email.value,
      "é…é”å¸Œæœ›æ—¥æ™‚": form.datetime.value,
      "ãŠç¤¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸": thanks.checked ? form.thanksMsg.value : ""
    };
    kv.innerHTML = Object.entries(data).map(([k,v])=>`
      <div class="k">${k}</div><div>${escapeHtml(v||"-")}</div>
    `).join("");
    form.hidden = true;
    confirmView.hidden = false;
    window.scrollTo({top:0,behavior:"smooth"});
  });

  document.getElementById("btnEdit").addEventListener("click", ()=>{
    confirmView.hidden = true;
    form.hidden = false;
  });

  document.getElementById("btnSend").addEventListener("click", ()=>{
    // æœ¬ç•ªã§ã¯ã“ã“ã§é€ä¿¡APIã‚’å©ã
    // fetch('/api/gifts', { method:'POST', body: new FormData(form) })
    alert("é€ä¿¡ã—ã¾ã—ãŸã€‚ã”å…¥åŠ›ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼");
  });

  function toggleError(id, isErr){
    const el = document.getElementById(id);
    el.classList.toggle("is-error", !!isErr);
    return !isErr;
  }
  const escapeHtml = (s)=> String(s).replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m]));

</script>
</body>
</html>
